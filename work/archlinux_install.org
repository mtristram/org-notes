#+TITLE: Notes on installing archlinux from scratch
#+AUTHOR: Xavier Garrido
#+DESCRIPTION: In this note, we describe the different operations for installing archlinux

* After booting on archlinux ISO file
Start loading the french keymap
#+BEGIN_SRC sh
  loadkeys fr
#+END_SRC

* Create and format the partitions :
First look if any partition is already present
#+BEGIN_SRC sh
  fdisk -l
#+END_SRC
If yes, then either use them and go directly to the "Mounting" part
or, format the disk using `fisk` or `cfdisk` utility.
#+BEGIN_SRC sh
  fdisk /dev/sda
#+END_SRC
Different strategies can then be adopted (see
https://wiki.archlinux.org/index.php/Partitioning). For the time
being, I have adopted the following and pretty simple one :
- a 20 Gb root partition
- all the other bytes for the /home partition

Example of `fdisk` partition :

|-----------+------+----------+-----------+-----------+----+--------|
| Device    | Boot |    Start |       End |    Blocks | Id | System |
| /dev/sda1 | *    |     2048 |  39063551 |  19530752 | 83 | Linux  |
| /dev/sda2 |      | 39063551 | 500118191 | 230527320 | 83 | Linux  |
|-----------+------+----------+-----------+-----------+----+--------|

Format partition is done with `mkfs` utility
#+BEGIN_SRC sh
  mkfs.ext4 /dev/sda1
  mkfs.ext4 /dev/sda2
#+END_SRC

* Mount the partitions
#+BEGIN_SRC sh
  mount /dev/sda1 /mnt
  mkdir /mnt/home && mount /dev/sda2 /mnt/home
#+END_SRC
* Connect to the internet
Use the `wifi-menu` utility, choose the wifi name and set the WPA key

* Install the base system
#+BEGIN_SRC sh
  pacstrap /mnt base base_devel
#+END_SRC

* Configure the system
** Generate a fstab
#+BEGIN_SRC sh
  genfstab -p /mnt >> /mnt/etc/fstab
#+END_SRC
** Next `chroot` into our newly installed system
#+BEGIN_SRC sh
  arch-chroot /mnt
#+END_SRC
** Symlink /etc/localtime
#+BEGIN_SRC sh
  ln -sf /usr/share/zoneinfo/Europe/Paris /etc/localtime
  hwclock --systohc --utc
#+END_SRC
** Uncomment the 'fr' lines in /etc/locale.gen file and generate it
#+BEGIN_SRC sh
  locale-gen
#+END_SRC
** Finally do
#+BEGIN_SRC sh
  echo LANG="fr_FR.UTF-8" > /etc/locale.conf
  export LANG=fr_FR.UTF-8
#+END_SRC
* Configuring the Console Keymap
#+BEGIN_SRC sh
  cd to /usr/share/kbd/keymaps/i386/azerty
#+END_SRC
Copy your default keymap (fr-pc.map.gz) to a new file fr-pc-personal.map.gz
Gunzip the new map file
Edit fr-pc-personal.map using your favorite editor.
- Swap CapsLock with Escape (Vim)
make keycode 1 = Caps_Lock and keycode 58 = Escape
Gzip the map file
Change the default keyboard layout file that will be used by editing
=/etc/vconsole.conf= and adding KEYMAP=fr-pc-personal
* Create a user account
First set the root password
#+BEGIN_SRC sh
  passwd
#+END_SRC
and install =sudo= command
#+BEGIN_SRC sh
  pacman -S sudo
#+END_SRC
Once you've installed sudo, you can allow your new user to run it by
editing your sudoers file:
#+BEGIN_SRC sh
  EDITOR=nano visudo
#+END_SRC
Scroll down until you find this line and uncomment it:
#+BEGIN_SRC sh
  %wheel ALL=(ALL) ALL
#+END_SRC

Before creating a user account, install zshell
#+BEGIN_SRC sh
  pacman -S zsh
#+END_SRC
Create a user account
#+BEGIN_SRC sh
  useradd -m -g users -G wheel,storage,power -s /bin/zsh garrido
  passwd garrido
#+END_SRC

* Install your GRUB bootloader
#+BEGIN_SRC sh
  pacman -S grub-bios
  grub-install --target=i386-pc --recheck /dev/sda
  cp /usr/share/locale/en\@quot/LC_MESSAGES/grub.mo
  /boot/grub/locale/en.mo
#+END_SRC
Target is always i386-pc even if the laptop/pc is a 64 bits machine

Run
#+BEGIN_SRC sh
grub-mkconfig -o /boot/grub/grub.cfg
#+END_SRC

* Setup your network
#+BEGIN_SRC sh
pacman -S wireless_tools wpa_supplicant wpa_actiond dialog
wifi-menu
systemctl enable net-auto-wireless.service
#+END_SRC

* Exit, unmount partitions and reboot
#+BEGIN_SRC sh
exit
umount /mnt/home
umount /mnt
reboot
#+END_SRC

* Sound, video and mouse drivers
+ Get sound
#+BEGIN_SRC sh
  sudo pacman -S alsa-utils
  alsamixer
  speaker-test -c 2
#+END_SRC
+ Install video driver (Intel)
#+BEGIN_SRC sh
  sudo pacman -S xf86-video-intel
#+END_SRC
+ Install mouse driver
#+BEGIN_SRC sh
  sudo pacman -S xf86-input-synaptics
#+END_SRC

* X window
+ Install X window system
#+BEGIN_SRC sh
  sudo pacman -S xorg-server xorg-xinit xorg-server-utils
#+END_SRC
+ Test default X environnement
#+BEGIN_SRC sh
  sudo pacman -S xorg-twm xorg-xclock xterm
  startx
#+END_SRC

* Install and set Openbox
#+BEGIN_SRC sh
  sudo pacman -S openbox
#+END_SRC
#+BEGIN_SRC sh
  mkdir -p ~/.config/openbox
  cp /etc/xdg/openbox/{rc.xml,menu.xml,autostart,environment}
  ~/.config/openbox
#+END_SRC

Add the following line to ~/.xinitrc
#+BEGIN_SRC sh
  echo "exec openbox-session" > ~/.xinitrc
#+END_SRC

Install yaourt : add the following line into /etc/pacman.conf
#+BEGIN_SRC sh
  [archlinuxfr]
  Server = http://repo.archlinux.fr/$arch
#+END_SRC
Then do
#+BEGIN_SRC sh
  sudo pacman -Sy yaourt
#+END_SRC

#+BEGIN_SRC sh
  yaourt -S openssh rsync
#+END_SRC

Install obconf, tint2 and hsetroot (wallpaper)
#+BEGIN_SRC sh
  sudo pacman -S obconf tint2 hsetroot
#+END_SRC

Install ubuntu-ttf font
#+BEGIN_SRC sh
  sudo pacman -S ttf-ubuntu-font-family
#+END_SRC

Install terminator
#+BEGIN_SRC sh
  sudo pacman -S terminator
#+END_SRC

Install emacs
#+BEGIN_SRC sh
  sudo pacman -S emacs
#+END_SRC

Install chromium
#+BEGIN_SRC sh
  sudo pacman -S chromium
#+END_SRC

Install xfce4 stuff
#+BEGIN_SRC sh
sudo pacman -S xfce4-notifyd thunar xfce4-volman file-roller
#+END_SRC

Install git and subversion
#+BEGIN_SRC sh
sudo pacman -S git subversion
#+END_SRC

Misc.
#+BEGIN_SRC sh
sudo pacman -S unzip mlocate flashplugin
#+END_SRC

* Openbox config
* Zsh config
#+BEGIN_SRC sh
git clone https://github.com/zsh-users/antigen.git
#+END_SRC
